<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PAKISTAN TV | News Portal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        :root { --bg-color: #f8f9fa; --text-color: #212529; --card-bg: #ffffff; --accent: #dc3545; }
        [data-bs-theme="dark"] { --bg-color: #121212; --text-color: #e0e0e0; --card-bg: #1e1e1e; }
        
        body { background-color: var(--bg-color); color: var(--text-color); transition: 0.3s; font-family: 'Segoe UI', sans-serif; }
        
        /* FIX: Responsive Category Header */
        .category-scroll-container {
            overflow-x: auto;
            white-space: nowrap;
            display: flex;
            gap: 10px;
            padding: 10px 0;
            scrollbar-width: none; /* Firefox */
        }
        .category-scroll-container::-webkit-scrollbar { display: none; } /* Chrome/Safari */

        .cat-link {
            text-decoration: none;
            color: var(--text-color);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85rem;
            padding: 5px 12px;
            border-radius: 20px;
            background: rgba(0,0,0,0.05);
        }
        [data-bs-theme="dark"] .cat-link { background: rgba(255,255,255,0.1); }
        .cat-link:hover { background: var(--accent); color: white; }

        /* News Cards */
        .news-card { height: 100%; border: none; background: var(--card-bg); transition: 0.3s; box-shadow: 0 4px 12px rgba(0,0,0,0.08); overflow: hidden; }
        .news-card:hover { transform: translateY(-5px); }
        .thumb-box { height: 200px; overflow: hidden; position: relative; }
        .thumb-box img { width: 100%; height: 100%; object-fit: cover; }
        
        /* Mobile Adjustments */
        @media (max-width: 768px) {
            .navbar-brand { font-size: 1.1rem; }
            .thumb-box { height: 160px; }
            .trending-section { padding: 10px; }
        }

        .view-section { display: none; padding-top: 20px; }
        .view-active { display: block; animation: fadeIn 0.4s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .gallery-img { width: 100%; height: 120px; object-fit: cover; border-radius: 8px; }
    </style>
</head>
<body data-bs-theme="light">

<nav class="navbar navbar-expand-lg bg-body-tertiary sticky-top shadow-sm">
    <div class="container">
        <a class="navbar-brand fw-bold text-danger" href="#" onclick="showSection('home')">üåê PAKISTAN TV</a>
        
        <div class="d-flex align-items-center order-lg-3">
            <button class="btn btn-link text-body p-2" onclick="toggleTheme()"><i class="bi bi-moon-stars-fill"></i></button>
            <button class="btn btn-dark btn-sm ms-2" onclick="showSection('login')">Admin</button>
            <button class="navbar-toggler ms-2" type="button" data-bs-toggle="collapse" data-bs-target="#navContent">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>

        <div class="collapse navbar-collapse" id="navContent">
            <div class="category-scroll-container mx-auto" id="header-categories">
                </div>
        </div>
    </div>
</nav>

<main id="home" class="view-section view-active container">
    <div id="trending-container" class="trending-section mb-4">
        <h6 class="fw-bold mb-3 text-danger"><i class="bi bi-fire"></i> TRENDING NEWS</h6>
        <div class="row g-2" id="trending-posts"></div>
    </div>
    <hr>
    <div class="row g-4 mt-2" id="main-feed"></div>
</main>

<section id="post-detail" class="view-section container">
    <button class="btn btn-sm btn-outline-secondary mb-3" onclick="showSection('home')"><i class="bi bi-arrow-left"></i> Back to News</button>
    <div id="post-content"></div>
</section>

<section id="login" class="view-section container">
    <div class="row justify-content-center mt-5">
        <div class="col-md-4 card p-4 shadow">
            <h4 class="text-center mb-4">Admin Access</h4>
            <input type="text" id="user" class="form-control mb-3" placeholder="Username">
            <input type="password" id="pass" class="form-control mb-3" placeholder="Password">
            <button class="btn btn-danger w-100" onclick="handleLogin()">Login</button>
        </div>
    </div>
</section>

<section id="admin" class="view-section container">
    <div class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-3">
        <h3>Admin Dashboard</h3>
        <button class="btn btn-outline-danger btn-sm" onclick="logout()">Logout</button>
    </div>
    <div class="row">
        <div class="col-md-4 mb-4">
            <div class="card p-3 shadow-sm">
                <h6>Add Category</h6>
                <div class="input-group mb-3">
                    <input type="text" id="new-cat" class="form-control form-control-sm">
                    <button class="btn btn-success btn-sm" onclick="addCategory()">Add</button>
                </div>
                <div id="admin-cat-list" class="list-group list-group-flush small"></div>
            </div>
        </div>
        <div class="col-md-8">
            <div class="card p-4 shadow-sm mb-4">
                <h6>Create New Post</h6>
                <div class="row g-3">
                    <div class="col-md-8"><input type="text" id="post-title" class="form-control" placeholder="News Headline"></div>
                    <div class="col-md-4"><select id="post-cat-select" class="form-select"></select></div>
                    <div class="col-12"><textarea id="post-desc" class="form-control" rows="4" placeholder="Full article content..."></textarea></div>
                    <div class="col-md-6">
                        <label class="small fw-bold">Thumbnail</label>
                        <input type="file" id="post-thumb" class="form-control form-control-sm" accept="image/*">
                    </div>
                    <div class="col-md-6">
                        <label class="small fw-bold">Gallery Images</label>
                        <input type="file" id="post-gallery" class="form-control form-control-sm" multiple accept="image/*">
                    </div>
                    <div class="col-12"><button class="btn btn-primary w-100" onclick="createPost()">Publish News</button></div>
                </div>
            </div>
            <div id="admin-post-list" class="row g-2"></div>
        </div>
    </div>
</section>

<script>
    /**
     * NOTE: To make this work on multiple devices, you must replace 
     * localStorage with a Database like Firebase.
     */

    let state = {
        posts: JSON.parse(localStorage.getItem('news_posts')) || [],
        cats: JSON.parse(localStorage.getItem('news_cats')) || ["Pakistan", "Politics", "Sports", "Showbiz", "Health"],
    };

    function sync() {
        localStorage.setItem('news_posts', JSON.stringify(state.posts));
        localStorage.setItem('news_cats', JSON.stringify(state.cats));
        render();
    }

    // Navigation & UI
    function showSection(id, postId = null) {
        document.querySelectorAll('.view-section').forEach(s => s.classList.remove('view-active'));
        document.getElementById(id).classList.add('view-active');
        if (id === 'post-detail') renderDetail(postId);
        // Collapse mobile menu if open
        const navContent = document.getElementById('navContent');
        if (navContent.classList.contains('show')) {
            bootstrap.Collapse.getInstance(navContent).hide();
        }
        window.scrollTo(0, 0);
    }

    function toggleTheme() {
        const body = document.body;
        const current = body.getAttribute('data-bs-theme');
        body.setAttribute('data-bs-theme', current === 'dark' ? 'light' : 'dark');
    }

    // Auth logic
    function handleLogin() {
        const u = document.getElementById('user').value;
        const p = document.getElementById('pass').value;
        if (u === 'newschannel' && p === 'news1122') {
            showSection('admin');
        } else { alert("Wrong password"); }
    }
    function logout() { showSection('home'); }

    // Admin Functions
    function addCategory() {
        const val = document.getElementById('new-cat').value.trim();
        if (val && !state.cats.includes(val)) {
            state.cats.push(val);
            document.getElementById('new-cat').value = "";
            sync();
        }
    }

    async function createPost() {
        const title = document.getElementById('post-title').value;
        const cat = document.getElementById('post-cat-select').value;
        const desc = document.getElementById('post-desc').value;
        const thumbFile = document.getElementById('post-thumb').files[0];
        
        if (!title || !thumbFile) return alert("Title and Thumbnail are required!");

        const thumbBase64 = await toBase64(thumbFile);
        const galleryFiles = document.getElementById('post-gallery').files;
        const gallery = [];
        for (let f of galleryFiles) gallery.push(await toBase64(f));

        state.posts.unshift({
            id: Date.now(),
            title,
            desc,
            cat,
            thumb: thumbBase64,
            views: 0,
            gallery,
            date: new Date().toLocaleDateString()
        });
        
        sync();
        alert("News Published Successfully!");
        // Clear inputs
        document.getElementById('post-title').value = "";
        document.getElementById('post-desc').value = "";
    }

    function deletePost(id) {
        if(confirm("Delete this post?")) {
            state.posts = state.posts.filter(p => p.id !== id);
            sync();
        }
    }

    const toBase64 = file => new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
    });

    // Rendering
    function render() {
        // Categories Navbar
        const catHtml = state.cats.map(c => `<a href="#" class="cat-link" onclick="filterByCat('${c}')">${c}</a>`).join('');
        document.getElementById('header-categories').innerHTML = `<a href="#" class="cat-link" onclick="showSection('home')">Home</a>` + catHtml;

        // Admin category list
        document.getElementById('admin-cat-list').innerHTML = state.cats.map(c => `
            <div class="list-group-item d-flex justify-content-between align-items-center bg-transparent border-0 px-0">
                <span><i class="bi bi-tag-fill me-2 text-primary"></i>${c}</span>
                <button class="btn btn-sm text-danger" onclick="deleteCategory('${c}')"><i class="bi bi-x-circle"></i></button>
            </div>`).join('');
        
        document.getElementById('post-cat-select').innerHTML = state.cats.map(c => `<option>${c}</option>`).join('');

        // Admin Post List
        document.getElementById('admin-post-list').innerHTML = state.posts.map(p => `
            <div class="col-12 d-flex align-items-center bg-body-tertiary p-2 rounded border mb-2">
                <img src="${p.thumb}" style="width:40px; height:40px; object-fit:cover;" class="rounded me-2">
                <div class="flex-grow-1 small fw-bold">${p.title.substring(0, 40)}...</div>
                <button class="btn btn-sm text-danger" onclick="deletePost(${p.id})"><i class="bi bi-trash"></i></button>
            </div>`).join('');

        renderFeed(state.posts);

        // Trending Section (Top 4 by views)
        const trending = [...state.posts].sort((a,b) => b.views - a.views).slice(0, 4);
        document.getElementById('trending-posts').innerHTML = trending.map(p => `
            <div class="col-6 col-md-3" onclick="showSection('post-detail', ${p.id})">
                <div class="card h-100 border-0 shadow-sm" style="cursor:pointer">
                    <img src="${p.thumb}" class="card-img-top" style="height:80px; object-fit:cover;">
                    <div class="p-2"><div class="fw-bold" style="font-size:0.7rem;">${p.title.substring(0,35)}...</div></div>
                </div>
            </div>`).join('');
    }

    function renderFeed(postsArray) {
        if(postsArray.length === 0) {
            document.getElementById('main-feed').innerHTML = `<div class="text-center p-5"><h5>No news found.</h5></div>`;
            return;
        }
        document.getElementById('main-feed').innerHTML = postsArray.map(p => `
            <div class="col-md-4">
                <div class="card news-card" onclick="showSection('post-detail', ${p.id})">
                    <div class="thumb-box">
                        <img src="${p.thumb}" alt="news">
                        <span class="badge bg-danger position-absolute top-0 start-0 m-2">${p.cat}</span>
                    </div>
                    <div class="card-body">
                        <h6 class="card-title fw-bold">${p.title}</h6>
                        <p class="card-text text-muted small">${p.desc.substring(0, 90)}...</p>
                        <div class="d-flex justify-content-between align-items-center mt-2 border-top pt-2">
                            <span class="text-muted" style="font-size: 11px;"><i class="bi bi-clock"></i> ${p.date}</span>
                            <span class="text-muted" style="font-size: 11px;"><i class="bi bi-eye"></i> ${p.views}</span>
                        </div>
                    </div>
                </div>
            </div>`).join('');
    }

    function filterByCat(cat) {
        showSection('home');
        const filtered = state.posts.filter(p => p.cat === cat);
        renderFeed(filtered);
    }

    function renderDetail(id) {
        const post = state.posts.find(p => p.id === id);
        if(!post) return;
        post.views++;
        sync();

        document.getElementById('post-content').innerHTML = `
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <span class="badge bg-danger mb-2">${post.cat}</span>
                    <h1 class="fw-bold mb-3">${post.title}</h1>
                    <p class="text-muted mb-4"><i class="bi bi-calendar-event"></i> Published on ${post.date} | <i class="bi bi-eye"></i> ${post.views} Views</p>
                    <img src="${post.thumb}" class="img-fluid rounded shadow-sm mb-4 w-100">
                    <div class="content-body lead mb-5" style="white-space: pre-line; line-height: 1.8;">${post.desc}</div>
                    
                    <h5 class="mb-3">Image Gallery</h5>
                    <div class="row g-2 mb-5">
                        ${post.gallery.map(img => `<div class="col-6 col-md-4"><img src="${img}" class="gallery-img shadow-sm border"></div>`).join('')}
                    </div>
                </div>
            </div>
        `;
    }

    render();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>